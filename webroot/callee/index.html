<!DOCTYPE html>
<html lang="en" id="main">
<head>
<!-- WebCall Copyright 2023 timur.mobi. All rights reserved. -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0">
<title>WebCall Callee</title>
<meta property="og:title" content="WebCall Audiophile Telephony">
<meta name="twitter:title" content="WebCall Audiophile Telephony">
<meta name="mobile-web-app-capable" content="yes">
<style>
::-webkit-scrollbar { display:none; }
html {
	width:100%; min-height:100%;
	background-image:linear-gradient(#004, #139);
	color:#ddd;
	scrollbar-width:none;
}
body {
	font-family:Sans-Serif;
	font-weight:300;
	margin:0;
}
button, button:focus {
	background-color:#04c;
	transition: background-color 200ms;
	border:none;
	border-radius:3px;
	color:white;
	font-size: 1.0em;
	margin: 0.3em 0.8em 0.4em 0;
	padding: 0.7em 0.5em 0.6em 0.5em;
	min-width: 110px;
	outline:none;
	user-select:none;
}
button:focus {
	_background-color: #6c6;
}
button:active {
	background-color: #02a;
	outline:none;
}
button[disabled] {
	color:#aaa;
}

@media (hover: hover) {
	button:hover {
		background-color: #b82a68;
		outline:none;
	}
	button[disabled]:hover {
		background-color:#04c;
	}
}

.menuButton, menuButton:focus {
	color:white;
	padding: 0 20px 0 20px; /* 20px = margin-left (16px) +4 of labels (see: fullscreenlabel) */
	user-select:none;
}
.menuButton:active {
	background-color: #b82a68;
	outline:none;
}
.menuButton[disabled] {
}
@media (hover: hover) {
	.menuButton:hover {
		color:#ff0;
		outline:none;
	}
	.menuButton[disabled]:hover {
	}
}
.menulabel {
	margin-left:16px; 
	margin-right:20px; 
	cursor:pointer;
}
.menulabel2 {
	margin-bottom:4px;
	cursor:pointer;
}

div#container {
	padding: 0.7em;
	padding-right: 0.4em;
	padding-left: 2.5%;
	max-width:600px;
	overflow:hidden;
}
h1 {
	font-size:1.1em;
	font-weight:600;
	user-select:none;
	margin-block-start:0;
	margin-block-end:0;
	margin-top:16px;
	margin-bottom:10px;
	line-height:1.3em;
}
a, a:link, a:visited, a:active {
    color:#ddd;
	font-weight:600;
    text-decoration:none;
	cursor:pointer;
}
@media (hover: hover) {
	a:hover {
		color:#fff;
		text-decoration:underline;
	}
}
label {
    display:inline-block;
}

.checkbox {
	-webkit-appearance: none;
	background-color:#227;
	border: 1px solid #cacece;
	padding: 6px;
	margin-bottom:-1px;
	border-radius: 3px;
	display: inline-block;
	position: relative;
	cursor: pointer;
	user-select:none;
}
.checkbox:active, .checkbox:checked:active {
}
.checkbox:checked {
	background-color: #3af;
}

.status {
	_margin-top:8px;
	_margin-bottom:8px;
	_padding-left:2px;
	width:98%;
	max-width:570px;
	line-height:1.3em;
	transition:opacity 400ms ease-out;
    color:#ccc;
}
.callListTitle {
	font-size:0.9em;
	color:#ff2;
	font-weight:500;
}
.callList {
	margin-top:4px;
	margin-bottom:18px;
	font-size:1.0em;
	line-height:1.2em;
	transition:opacity 400ms;
    color:#ddd;
}
.msgbox {
	font-size:1.2em;
	margin-top:6px;
	width:95%;
	max-width:550px;
	height:4em;
	padding:10px;
	background-image: linear-gradient(#12b,#25f);
	border:none;
	border-radius:3px;
	color:#fff;
	outline:none;
	overflow-y:auto;
	scrollbar-color: #119 #25f;
}
select, select:focus {
	margin-top:5px;
	background-color:#04c;
	color:#ccc;
	font-size:1.0em;
	border:none;
    padding: 0.3em 0.5em 0.2em 0.5em;
	width:340px;
	max-width:97%;
	outline:none;
	user-select:none;
	margin: 0 10px 10px 0;
}
select:focus {
	outline:none;
	background-color: #6c6;
	color:#000;
}
.timer {
	position:absolute;
	right:10px;
	bottom:10px;

	width:200px;
	color:#555;
	font-size:4.0em;
	font-weight:500;
	opacity:0.0;
	transition:opacity 400ms;
	text-align:center;
	z-index:-10;
}

form {
	margin-top:18px;
	font-size:1.2em;
}
.formtext {
	border-radius:4px;
	border:none;
	width:86%;
	max-width:360px;
	font-size:1.2em;
	color:#000;
	padding:4px 4px; box-sizing:border-box;
	outline:none;
	background:#0de;
	box-shadow:none; /* removes red border in FF */
}
.formtext:focus {
	background-color: #0fc;
	color:#000;
}
input[type=submit] {
	font-size:1.0em;
	background:#06f;
	border: none;
	color: white;
	padding: 8px;
	text-decoration: none;
	cursor: pointer;
}
input[type=submit]:focus {
	background-color: #9d9;
	color: #000;
}
@media (min-aspect-ratio: 13/10) {
	.videoframe-remote {
		width:49%; float:left; user-select:none; padding-right:2px;
	}
	.videoframe-local {
		width:49%; float:left; user-select:none;
	}
}
@media (max-aspect-ratio: 13/10) {
	.videoframe-remote {
		width:100%; user-select:none;
	}
	.videoframe-local {
		width:100%; user-select:none;
	}
}
.blink_me {
	animation: blinker 800ms linear infinite;
}
@keyframes blinker {
	50% {
	    opacity: 0.2;
	}
}
.spinnerframe {
	width:100%;
	height:100vh;
	position:absolute;
}
.spinner {
	margin: 0 auto;
	border: 8px solid #f3f3f3;
	border-radius: 50%;
	border-top: 8px solid #3468ab;
	width: 60px;
	height: 60px;
	animation: spin 2s linear infinite;
	position: absolute;
	top: 50%;
	left: 50%;
	margin: -34px 0 0 -38px;
}
@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}
.mirrorvideo {
	/* suggested by Konsthol */
	transform: scale(-1, 1);
	-webkit-transform: scale(-1, 1);
}
.iconbutton {
	position:relative; float:right; width:30px; margin-left:17px; margin-right:17px; margin-top:6px;
	z-index:100; user-select:none; cursor:pointer; 
	transition:all 300ms ease-out;
	opacity:0.8; 
}
.iconbutton:hover, .iconbutton:active {
	opacity:1; 
}

@media only screen and (max-width: 460px) {
	.iconbutton {
		position:relative; float:right; width:28px; margin-left:12px; margin-right:12px; margin-top:7px;
	}
}

@media only screen and (max-width: 390px) {
	.iconbutton {
		position:relative; float:right; width:25px; margin-left:10px; margin-right:10px; margin-top:8px;
	}
}

@media only screen and (max-width: 330px) {
	.iconbutton {
		position:relative; float:right; width:22px; margin-left:7px; margin-right:7px; margin-top:10px;
	}
}


/* css switch by Marcus Burnette https://codepen.io/mburnette/ */
.switch input {
  display: none;
}

.switch {
  display: inline-block;
  width: 60px;
  height: 30px;
  margin: 4px;
  position: relative;
}

.slider {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  border-radius: 30px;
  box-shadow: 0 0 0 2px #ccc, 0 0 4px #ccc;
  cursor: pointer;
  border: 4px solid transparent;
  overflow: hidden;
  transition: 0.2s;
}

.slider:before {
  position: absolute;
  content: "";
  width: 100%;
  height: 100%;
  background-color: #ccc;
  border-radius: 30px;
  transform: translateX(-30px); /*translateX(-(w-h))*/
  transition: 0.2s;
}

input:checked + .slider:before {
  transform: translateX(30px); /*translateX(w-h)*/
  background-color: #7af;
}

input:checked + .slider {
  box-shadow: 0 0 0 2px #ddd, 0 0 8px #ddd;
}
/*
input:disabled + .slider {
  background-color: #700;
  box-shadow: 0 0 0 2px #333, 0 0 8px #333;
}
*/

.buttonRow {
	display:grid;
	grid-template-columns: 1fr 6fr;
	list-style-type:none;
	max-height:40px;
}
</style>
</head>

<body>
<div id="spinnerframe" class="spinnerframe" style="display:none;">
    <div id="spinner" class="spinner"></div>
</div>
<img src="phone.svg"
	style="position:absolute;right:0;top:2vh;width:440px;max-height:80vh;padding:2%;user-select:none;opacity:0.1;z-index:-1;">

<div id="fullScreenOverlay" style="position:absolute; left:0; top:0; margin:0; padding:0; width:100%; height:100%; z-index:105; display:none;"></div>

<div id="showMsg" style="position:relative; width:98%; user-select:none;" onClick="history.back();">
	<div id="showMsgInner" style="position:absolute; left:-999em; top:0; z-index:110; background:#45d; color:#fff; padding:10px 15px; line-height:1.5em; font-size:1.2em; border-radius:3px; cursor:pointer;">
	</div>
</div>

<div id="iframeWindow" style="display:none"></div>

<!-- max-width same as for container -->
<div id="menuDialog" style="position:relative; max-width:600px; user-select:none; display:none;">
	<div style="position:absolute; right:10px; top:0; z-index:110; background:#45dd; color:#fff; padding:10px 0px; line-height:2.6em; border-radius:3px; cursor:pointer;">
		<div id="menuSettings" class="menuButton" style="display:none" onclick="openSettings()">Settings</div>
		<div id="idMapping" class="menuButton" style="display:none" onclick="openIdMapping()">ID Manager</div>
		<div class="menuButton" onclick="openPostCallStats()">Call Stats</div>
		<label class="menuButton" id="fileselectlabel" for="fileselect" 
			style="cursor:pointer; display:none;">
			Send File
			<input id="fileselect" type="file" style="display:none"></input>
		</label>
		<div class="menuButton" id="nativeMenu" style="display:none"
			onclick="history.back(); Android.menu()">Device options</div>
		<!-- enabled by android client -->
		<div class="menuButton" id="menuClearCache" onclick="clearcache()" style="display:none;">Clear cache</div>
		<!-- enabled by login -->
		<div class="menuButton" id="menuClearcookie" onclick="clearcookie2()"
			style="display:none;">Clear cookie</div>
		<div class="menuButton" id="menuExit" onclick="exit()" style="display:none;">Exit</div>
	</div>
</div>

<div id="vresDialog" style="position:relative; max-width:520px; user-select:none;">
	<div style="position:absolute; left:-999em; top:0; z-index:110; background:#45dd; color:#fff; padding:10px 20px; line-height:2.6em; border-radius:3px; cursor:pointer;">
		<div onclick="setVideoConstraintsLow();history.back();">Low Resolution</div>
		<div onclick="setVideoConstraintsMid();history.back();">Mid Resolution</div>
		<div onclick="setVideoConstraintsHigh();history.back();">High Resolution</div>
		<div onclick="setVideoConstraintsHD();history.back();">HD+ Resolution</div>
	</div>
</div>

<div style="background:#111a;font-size:1.2em;color:#fff;">
	<div id="remoteVideoDiv" class="videoframe-remote" style="height:0px; transition:height 600ms; overflow:hidden;">
		<div style="position:relative; width:100%;">
			<video id="remoteVideoFrame" style="width:100%; background:#000b; transition:opacity 1000ms; aspect-ratio:16/9;" _poster="" autoplay playsInline=""></video>
			<span id="remoteVideoRes" style="position:absolute; bottom:10%; left:50%; transform:translate(-50%,-50% ); text-align:center; background:#000b; padding:5px 10px; z-index:20; font-size:0.7em; visibility:hidden;"></span>
			<div id="remoteVideoLabel" style="position:absolute; bottom:0; width:100%; z-index:30; opacity:0.7; text-align:center; background:#000b; transition:opacity 500ms;"></div>
		</div>
	</div>

	<div id="localVideoDiv" class="videoframe-local" style="height:0px; transition:height 600ms; overflow:hidden; cursor:pointer;">
		<div style="position:relative; width:100%;">
			<video id="localVideoFrame" class="mirrorvideo" style="width:100%; background:#000b; transition:opacity 1000ms; aspect-ratio:16/9;" _poster="" autoplay muted playsInline=""></video>
			<span id="localVideoMsg" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50% ); text-align:center; background:#000b; padding:5px 10px; z-index:20; font-size:0.8em; opacity:0;"></span>
			<span id="localVideoRes" style="position:absolute; bottom:10%; left:50%; transform:translate(-50%,-50% ); text-align:center; background:#000b; padding:5px 10px; z-index:20; font-size:0.7em; visibility:hidden;"></span>
			<div id="localVideoLabel" style="position:absolute; bottom:0; width:100%; z-index:30; opacity:0.7; text-align:center; background:#000b; transition:opacity 500ms;">
				<span id="vres" onclick="menuDialogOpen(vresDialogElement,1)">res</span>
				<span id="vmonitor" onclick="vmonitorSwitch()" style="margin-left:3%">monitor</span>
				<span id="vsend" onclick="connectLocalVideo(false)" style="margin-left:3%;display:none;">send</span>
				<span id="vclose" onclick="videoSwitch(true)" style="margin-left:3%">close</span>
			</div>
		</div>
	</div>
	<div style="clear:both"></div>
</div>

<div id="dynDialog" style="position:relative; user-select:none; display:none;"></div>

<div id="container">
	<div class="buttonRow">
		<label class="switch" style="margin-top:8px;">
			<input type="checkbox" id="onlineSwitch">
			<span class="slider"></span>
		</label>

		<div>
		<img id="menu"         onclick="menuDialogOpen(menuDialogElement,1)" src="menu.svg" class="iconbutton">
		<img id="checkboxes"   onclick="openSlide()"        src="checkboxes.svg"  class="iconbutton">
		<img id="dialpad"      onclick="openDialId('')"     src="dialpad.svg"     class="iconbutton">
		<img id="iconContacts" onclick="openContacts()"     src="contacts.svg"    class="iconbutton">
		<img id="camera"       onclick="videoSwitch(false)" src="camera.svg"      class="iconbutton">
		<img id="exclamation"  onclick=""                   src="exclamation.svg" class="iconbutton" style="display:none;">
		</div>
	</div>
    <div style="clear:all;height:2px; _background:#666;"></div>


	<h1><span>WebCall</span> <span id="title"></span></h1>

	<!-- turn not with "display:grid" -->
	<div id="answerButtons" style="display:none; grid-template-columns: 5fr 5fr 1fr; max-width:400px; margin-right:30px;">
		<button id="answerButton">Answer</button>
		<button id="rejectButton">Hang Up</button>
		<img id="onlineIndicator" src="green-gradient.svg" style="width:30px; margin-top:12px; user-select:none;">
	</div>

	<div id="status" class="status" style="margin-top:10px;"></div>

	<form action="javascript:;" onsubmit="submitFormDone(1)" style="max-width:420px;display:none;" id="password">
		<input type="text" autocomplete="username" id="username" style="display:none;" required>
		<label for="current-password" style="display:inline-block;">Password:</label>
		<span onclick="showPw()" style="font-size:0.95em;float:right;margin-right:16%;margin-top:2px;opacity:0.9;user-select:none;cursor:pointer;">show</span>
		<br>
		<input autocomplete="current-password" id="current-password" type="password" class="formtext" autofocus required>
		<span onclick="clearForm()" style="margin-left:5px; user-select:none; cursor:pointer;">X</span><br>
		<input type="submit" name="Submit" id="submit" value="OK" style="width:120px; margin-top:12px;">
	</form>

	<div id="slideReveal" style="height:0px; transition:height 300ms; overflow:hidden; cursor:pointer;">
		<select id="avSelect" class="select" onchange="getStream(this)" style="margin-top:10px"></select>
		<div style="margin-top:5px;"></div>

		<div style="columns:7rem auto;white-space:nowrap;max-width:340px;">
			<div id="muteMicDiv" _style="display:none;">
				<input type="checkbox" id="muteMic" class="checkbox" />
				<label class="menulabel2" id="muteMiclabel" for="muteMic">Mic muted</label>
			</div>
			<!--label class="menulabel2" id="" _style="display:none;">
				<input type="checkbox" id="" class="checkbox"> Ring mute</label-->
			<label class="menulabel2" id="isHiddenlabel" style="display:none;">
				<input type="checkbox" id="isHidden" class="checkbox"> Hide me</label>
			<label class="menulabel2" id="autoanswerlabel" style="display:none;">
				<input type="checkbox" id="autoanswer" class="checkbox"> Auto-Answer</label>
			<label class="menulabel2" id="fullscreenlabel">
				<input type="checkbox" id="fullscreen" class="checkbox"> Full screen</label>
		</div>
	</div>

	<div id="progressSend" style="width:100%;max-width:360px;margin-top:10px;display:none;">
		<div id="progressSendLabel">sending:</div>
		<progress id="fileProgressSend" max="0" value="0" style="width:100%" onclick="stopProgressSend()"></progress>
	</div>
	<div id="download" style="margin-top:10px; margin-bottom:10px;"></div>
	<div id="progressRcv" style="width:100%;max-width:360px;display:none;">
		<div id="progressRcvLabel">receiving:</div>
		<progress id="fileProgressRcv" max="0" value="0" style="width:100%" onclick="stopProgressRcv()"></progress>
	</div>

	<textarea id="msgbox" class="msgbox" spellcheck="false" style="display:none"></textarea>
	<button id="chatButton" style="display:none; margin-top:4px; padding-top:4px; padding-bottom:3px;">TextChat</button>
	<div id="textbox" style="display:none;">
		<form action="javascript:;" onsubmit="submitFormDone(2)" style="margin-top:4px;">
			<input name="enterText" id="enterText" type="text" class="formtext" style="width:98%; max-width:550px; font-size:1.1em;">
			<input type="submit" name="Submit" id="submitText" value="" style="display:none">
		</form>
	</div>

	<div id="ownlink" style="opacity:0.9;_margin-top:4px;"></div>

	<div id="waitingCallersTitle" class="callListTitle" style="color:#f46; display:none;">Waiting calls:</div>
	<div id="waitingCallers" class="callList"></div>

	<div id="missedCallsTitle" class="callListTitle" style="display:none;">Missed calls:</div>
	<div id="missedCalls" class="callList"></div>

	<div id="timer" class="timer">4:32</div>
	<div style="opacity:0.7;margin-top:15px;user-select:none;">WebCall by <a id="webcallhome" href="https://timur.mobi/webcall">timur.mobi</a> <span id="version"></span></div>
</div>
</body>

<script>
const apiPath = "/rtcsig";
var gentle = true;
</script>
<script src="client.js"></script>
<script src="callee.js"></script>
<script src="prefercodec.js"></script>
<script src="adapter-latest.js"></script>

