<!DOCTYPE html>
<html lang="en" id="main">
<head>
<!-- WebCall Copyright 2023 timur.mobi. All rights reserved. -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0">
<title>WebCall Callee</title>
<meta property="og:title" content="WebCall Audiophile Telephony">
<meta name="twitter:title" content="WebCall Audiophile Telephony">
<meta name="mobile-web-app-capable" content="yes">
<style>
::-webkit-scrollbar { display:none; }
html {
	width:100%; min-height:100%;
	background-image:linear-gradient(#004, #139);
	color:#ddd;
	scrollbar-width:none;
}
body {
	font-family:Sans-Serif;
	font-weight:300;
	margin:0;
	scrollbar-width:none;
}

.buttonRow {
	display:grid;
	grid-template-columns: 70px 8fr;
	list-style-type:none;
	padding-top:8px;
	padding-bottom:16px;
	_max-height:40px;
}

.icongrid {
	display:grid;
	grid-template-columns: 44px 44px 44px 44px 44px 44px;
	direction: rtl;
	column-gap: 12px;
	padding-right:12px;
}

@media only screen and (max-width: 420px) {
	.icongrid {
		margin-top:3px;
		grid-template-columns: 32px 32px 32px 32px 32px 32px;
	}
}

@media only screen and (max-width: 344px) {
	.icongrid {
		margin-top:5px;
		grid-template-columns: 28px 28px 28px 28px 28px 28px;
		column-gap: 8px;
	}
}

@media only screen and (max-width: 300px) {
	.icongrid {
		margin-top:8px;
		grid-template-columns: 24px 24px 24px 24px 24px 24px;
		column-gap: 6px;
	}
}

.iconbutton {
	width:100%;
	max-width:36px;
	opacity:0.8;
	transition:all 300ms ease-out;
	z-index:100; user-select:none; cursor:pointer;
}

.iconbutton:hover {
	opacity:1; 
}

.iconbutton:active {
	opacity:0.2;
}

/* Answer, Hang Up, TextChat, Send File */
.callScreen {
	margin: 0 auto;
	_padding-top:10px;
	padding-bottom:15px;
	border-radius:8px;
	width:86%;
	padding-left:12px;
	padding-right:12px;
	background-color: navy;
}
.answerButtons {
	padding-top:10px;
	padding-bottom:15px;
	display:grid;
	grid-template-columns: 5fr 5fr;
	column-gap:16px;
	row-gap:18px;
	width:96%;
	max-width:320px;
	margin: 0 auto;
}
@media only screen and (min-width: 580px) {
	.callScreen {
		width:95%;
		max-width:700px;
	}
	.answerButtons {
		width:98%;
		max-width:600px;
		grid-template-columns: repeat(4, 5fr);
	}
}

.mainbutton, .mainbutton:focus {
	background-color:#0000;
	transition: all 200ms ease-in-out;
	border: 1.2px solid #ccc;
	border-radius:6px;
	color:#eee;
	font-size: 1.0em;
	font-weight: 400;
	font-family:sans-serif;
	padding: 0.4em 0.1em 0.4em 0.1em;
	min-width: 100px;
	_max-width: 180px;
	outline: none;
	text-align: center;
	user-select: none;
	cursor: pointer;
	box-sizing: border-box;
}
.mainbutton:active {
	background-color: #02a;
	outline:none;
}
.mainbutton[disabled] {
	opacity:0.7;
}
.mainbutton:focus {
	color: #fff;
}
@media (hover: hover) {
	.mainbutton:hover {
		background-color: #69f;
		border: 1.2px solid #69f;
		outline:none;
		color:#fff;
	}
/*
	.mainbutton[disabled]:hover {
		color:#aaa;
	}
	.mainbutton[disabled]:hover {
		background-color:#04c;
	}
*/
}

.status {
	padding-top: 12px;
	padding-bottom: 12px;
	width: 98%;
	max-width: 570px;
	transition: opacity 400ms ease-in-out;
    color: #ccc;
    font-weight: 600;
    font-size: 1.1em;
}

/* hamburger menu buttons */
.menuButton, menuButton:focus {
	color:white;
	padding: 0 20px 0 20px; /* 20px = margin-left (16px) +4 of labels (see: fullscreenlabel) */
	user-select:none;
}
.menuButton:active {
	background-color: #b82a68;
	outline:none;
}
.menuButton[disabled] {
}
@media (hover: hover) {
	.menuButton:hover {
		color:#ff0;
		outline:none;
	}
	.menuButton[disabled]:hover {
	}
}
.menulabel {
	margin-left:16px; 
	margin-right:20px; 
	cursor:pointer;
}
.menulabel2 {
	margin-bottom:4px;
	cursor:pointer;
}

div#containerOuter {
	width:100%;
	_display:flex;
	_justify-content:center;
	scrollbar-width:none;
	overflow:hidden;
}

div#container {
	padding-top:5px;
	padding-bottom:5px;
	padding-left: 2%;
	padding-right: 2%;
	max-width:740px;
	overflow:hidden;
	scrollbar-width:none;
}

a, a:link, a:visited, a:active {
    color:#ddd;
	font-weight:600;
    text-decoration:none;
	cursor:pointer;
}
@media (hover: hover) {
	a:hover {
		color:#fff;
		text-decoration:underline;
	}
}
label {
    display:inline-block;
}

.checkbox {
	-webkit-appearance: none;
	background-color:#227;
	border: 1px solid #cacece;
	padding: 6px;
	margin-bottom:-1px;
	border-radius: 3px;
	display: inline-block;
	position: relative;
	cursor: pointer;
	user-select:none;
}
.checkbox:active, .checkbox:checked:active {
}
.checkbox:checked {
	background-color: #4cf;
}

.callListTitle {
	padding-top:14px;
	font-size:0.9em;
	font-weight:600;
	color:#ff2;
	font-weight:500;
}
.callList {
	padding-bottom:12px;
	padding-right:2px;
	font-size:1.0em;
	line-height:1.2em;
	transition:opacity 400ms;
	color:#ddd;
	_width:99%;
	_max-width:580px;
}
.msgbox {
	padding-top:2px;
	padding-bottom:2px;
	font-size:1.0em;
	width:97%;
	max-width:550px;
	height:85px;
	background-image: linear-gradient(#12b,#25f);
	border:none;
	border-radius:5px;
	color:#fff;
	outline:none;
	overflow-y:auto;
	scrollbar-color: #119 #25f;
}
select, select:focus {
	margin-top:5px;
	background-color:#04c;
	color:#ccc;
	font-size:1.0em;
	border:none;
    padding: 0.3em 0.5em 0.2em 0.5em;
	width:340px;
	max-width:97%;
	outline:none;
	user-select:none;
	margin: 0 10px 10px 0;
}
select:focus {
	outline:none;
	background-color: #6c6;
	color:#000;
}
.timer {
	position:absolute;
	right:10px;
	bottom:10px;

	width:200px;
	color:#555;
	font-size:4.0em;
	font-weight:500;
	opacity:0.0;
	transition:opacity 400ms;
	text-align:center;
	z-index:-10;
}

form {
	_margin-top:18px;
	_font-size:1.2em;
}
.formtext {
	padding-top:2px;
	padding-bottom:2px;
	border-radius:4px;
	border:none;
	width:86%;
	max-width:360px;
	font-size:1.1em;
	color:#000;
	box-sizing:border-box;
	outline:none;
	background:#0bc;
	box-shadow:none; /* removes red border in FF */
}
.formtext:focus {
	background-color: #0dc;
	color:#000;
}
input[type=submit] {
	font-size:1.0em;
	background:#06f;
	border: none;
	color: white;
	padding: 8px;
	text-decoration: none;
	cursor: pointer;
}
input[type=submit]:focus {
	background-color: #9d9;
	color: #000;
}
@media (min-aspect-ratio: 13/10) {
	.videoframe-remote {
		width:49%; float:left; user-select:none; padding-right:2px;
	}
	.videoframe-local {
		width:49%; float:left; user-select:none;
	}
}
@media (max-aspect-ratio: 13/10) {
	.videoframe-remote {
		width:100%; user-select:none;
	}
	.videoframe-local {
		width:100%; user-select:none;
	}
}
.blink_me {
	animation: blinker 800ms linear infinite;
}
@keyframes blinker {
	50% {
	    opacity: 0.2;
	}
}
.spinnerframe {
	width:100%;
	height:100vh;
	position:absolute;
}
.spinner {
	_margin: 0 auto;
	border: 8px solid #f3f3f3;
	border-radius: 50%;
	border-top: 8px solid #3468ab;
	width: 60px;
	height: 60px;
	animation: spin 2s linear infinite;
	position: absolute;
	top: 50%;
	left: 50%;
	margin: -34px 0 0 -38px;
}
@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}
.mirrorvideo {
	/* suggested by Konsthol */
	transform: scale(-1, 1);
	-webkit-transform: scale(-1, 1);
}

/*
.iconbutton {
	position:relative; float:right; width:36px; margin-left:13px; margin-right:13px; margin-top:-1px;
	z-index:100; user-select:none; cursor:pointer; 
	transition:all 300ms ease-out;
	opacity:0.8; 
}
.iconbutton:hover, .iconbutton:active {
	opacity:1; 
}

@media only screen and (max-width: 460px) {
	.iconbutton {
		position:relative; float:right; width:32px; margin-left:10px; margin-right:10px; margin-top:1px;
	}
}

@media only screen and (max-width: 390px) {
	.iconbutton {
		position:relative; float:right; width:28px; margin-left:8px; margin-right:8px; margin-top:4px;
	}
}

@media only screen and (max-width: 330px) {
	.iconbutton {
		position:relative; float:right; width:24px; margin-left:6px; margin-right:6px; margin-top:6px;
	}
}
*/

/* online switch top left, css by Marcus Burnette https://codepen.io/mburnette/ */
.switch input {
	display: none;
}

.switch {
	display: inline-block;
	width: 60px;
	height: 30px;
	margin: 4px;
	position: relative;
}

.slider {
	position: absolute;
	top: 0; bottom: 0; left: 0; right: 0;
	border-radius: 30px;                        /* round frame */
	box-shadow: 0 0 0 2.5px #ccc, 0 0 5px #ccc; /* round frame */
	cursor: pointer;
	border: 4px solid transparent;				/* invisible inner frame */
	overflow: hidden;
	__transition: 0.2s;
}

.slider::before {
	position: absolute;
	content: "";
	width: 100%;
	height: 100%;
	background-color: #ccc;
	border-radius: 30px;
	transform: translateX(-30px); /*translateX(-(w-h))*/
	transition: 0.2s;
}

input:checked + .slider::before {
	transform: translateX(30px); /*translateX(w-h)*/
	_background-color: #3af;
}

/*
input:checked + .slider {
	_box-shadow: 0 0 0 2.5px #ddd, 0 0 8px #ddd;
	_background-color: #3af;
	_background-color: #27c;
}
input:disabled + .slider {
	background-color: #700;
	box-shadow: 0 0 0 2.5px #333, 0 0 8px #333;
}
*/

</style>
</head>

<body>
<div id="spinnerframe" class="spinnerframe" style="display:none;">
    <div id="spinner" class="spinner"></div>
</div>
<img src="phone.svg"
	style="position:absolute;right:0;top:2vh;width:440px;max-height:80vh;padding:2%;user-select:none;opacity:0.1;z-index:-1;">

<div id="fullScreenOverlay" style="position:absolute; left:0; top:0; margin:0; padding:0; width:100%; height:100%; z-index:105; display:none;"></div>

<div id="showMsg" style="position:relative; width:98%; user-select:none;" onClick="history.back();">
	<div id="showMsgInner" style="position:absolute; left:-999em; top:0; z-index:110; background:#45d; color:#fff; padding:10px 15px; line-height:1.5em; font-size:1.2em; border-radius:3px; cursor:pointer;">
	</div>
</div>

<div id="iframeWindow" style="display:none"></div>

<!-- max-width same as for container -->
<div id="menuDialog" style="position:relative; max-width:740px; user-select:none; display:none;">
	<div style="position:absolute; right:10px; top:0; z-index:110; background:#45dd; color:#fff; padding:10px 0px; line-height:2.6em; border-radius:3px; cursor:pointer;">
		<div id="menuSettings" class="menuButton" style="display:none" onclick="openSettings()">Settings</div>
		<div id="idMapping" class="menuButton" style="display:none" onclick="openIdMapping()">ID Manager</div>
		<div class="menuButton" onclick="openPostCallStats()">Call Stats</div>
		<div class="menuButton" id="nativeMenu" style="display:none"
			onclick="history.back(); Android.menu()">Device options</div>
		<!-- enabled by android client -->
		<div class="menuButton" id="menuClearCache" onclick="clearcache()" style="display:none;">Clear cache</div>
		<!-- enabled by login -->
		<div class="menuButton" id="menuClearcookie" onclick="clearcookie2()"
			style="display:none;">Clear cookie</div>
		<div class="menuButton" id="menuExit" onclick="exit()" style="display:none;">Exit</div>
	</div>
</div>

<div id="vresDialog" style="position:relative; max-width:520px; user-select:none;">
	<div style="position:absolute; left:-999em; top:0; z-index:110; background:#45dd; color:#fff; padding:10px 20px; line-height:2.6em; border-radius:3px; cursor:pointer;">
		<div onclick="setVideoConstraintsLow();history.back();">Low Resolution</div>
		<div onclick="setVideoConstraintsMid();history.back();">Mid Resolution</div>
		<div onclick="setVideoConstraintsHigh();history.back();">High Resolution</div>
		<div onclick="setVideoConstraintsHD();history.back();">HD+ Resolution</div>
	</div>
</div>

<div style="background:#111a;font-size:1.2em;color:#fff;">
	<div id="remoteVideoDiv" class="videoframe-remote" style="height:0px; transition:height 600ms; overflow:hidden;">
		<div style="position:relative; width:100%;">
			<video id="remoteVideoFrame" style="width:100%; background:#000b; transition:opacity 1000ms; aspect-ratio:16/9;" _poster="" autoplay playsInline=""></video>
			<span id="remoteVideoRes" style="position:absolute; bottom:10%; left:50%; transform:translate(-50%,-50% ); text-align:center; background:#000b; padding:5px 10px; z-index:20; font-size:0.7em; visibility:hidden;"></span>
			<div id="remoteVideoLabel" style="position:absolute; bottom:0; width:100%; z-index:30; opacity:0.7; text-align:center; background:#000b; transition:opacity 500ms;"></div>
		</div>
	</div>

	<div id="localVideoDiv" class="videoframe-local" style="height:0px; transition:height 600ms; overflow:hidden; cursor:pointer;">
		<div style="position:relative; width:100%;">
			<video id="localVideoFrame" class="mirrorvideo" style="width:100%; background:#000b; transition:opacity 1000ms; aspect-ratio:16/9;" _poster="" autoplay muted playsInline=""></video>
			<span id="localVideoMsg" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50% ); text-align:center; background:#000b; padding:5px 10px; z-index:20; font-size:0.8em; opacity:0;"></span>
			<span id="localVideoRes" style="position:absolute; bottom:10%; left:50%; transform:translate(-50%,-50% ); text-align:center; background:#000b; padding:5px 10px; z-index:20; font-size:0.7em; visibility:hidden;"></span>
			<div id="localVideoLabel" style="position:absolute; bottom:0; width:100%; z-index:30; opacity:0.7; text-align:center; background:#000b; transition:opacity 500ms;">
				<span id="vres" onclick="menuDialogOpen(vresDialogElement,1)">res</span>
				<span id="vmonitor" onclick="vmonitorSwitch()" style="margin-left:3%">monitor</span>
				<span id="vsend" onclick="connectLocalVideo(false)" style="margin-left:3%;display:none;">send</span>
				<span id="vclose" onclick="videoSwitch(true)" style="margin-left:3%">close</span>
			</div>
		</div>
	</div>
	<div style="clear:both"></div>
</div>

<div id="dynDialog" style="position:relative; user-select:none; display:none;"></div>

<div id="containerOuter">
<div id="container">
	<div class="buttonRow" id="buttonRow" >
		<label id="onlineLabel" class="switch" style="margin-top:5px;">
			<input type="checkbox" id="onlineSwitch">
			<span id="onlineSwitchSlider" class="slider"></span>
		</label>
<!--
		<span style="position:relative; user-select:none;">
			<img id="peerConIndicator" src=""
				 style="width:100%; position:absolute; top:50%; transform:translateY(-42%);">
		</span>
-->
		<span class="icongrid">
		<img id="menu"         onclick="menuDialogOpen(menuDialogElement,1)" src="menu.svg" class="iconbutton">
		<img id="checkboxes"   onclick="openSlide()"        src="checkboxes.svg"  class="iconbutton">
		<img id="dialpad"      onclick="openDialId('')"     src="dialpad.svg"     class="iconbutton">
		<img id="iconContacts" onclick="openContacts()"     src="contacts.svg"    class="iconbutton" style="display:none;">
		<img id="camera"       onclick="videoSwitch(false)" src="camera.svg"      class="iconbutton">
		<img id="exclamation"  onclick=""                   src="exclamation.svg" class="iconbutton" style="display:none;">
		</span>
	</div>
    <!--div style="clear:all;height:8px; _background:#666;"></div-->

	<!-- turn on with "display:grid" -->
	<div id="callScreen" class="callScreen" style="display:none">
		<div id="callScreenType" style="text-align:center;padding-top:20px;margin-bottom:20px;color:#fff;font-weight:600;">---</div>
		<div id="callScreenPeerData" style="text-align:center;margin:20px;color:#fff;font-weight:600;">---</div>
		<div id="answerButtons" class="answerButtons">
			<button id="answerButton" class="mainbutton">Answer</button>
			<button id="rejectButton" class="mainbutton">Hang Up</button>
			<button id="chatButton" class="mainbutton">TextChat</button>
			<label id="fileselectlabel" class="mainbutton" for="fileselect">
				Send File
				<input id="fileselect" type="file" style="display:none"></input>
			</label>
		</div>
	</div>

	<div id="status" class="status" style="display:none"></div>

	<form action="javascript:;" onsubmit="submitFormDone(1)" style="max-width:420px;margin-top:20px;display:none;" id="password">
		<input type="text" autocomplete="username" id="username" style="display:none;" required>
		<label for="current-password" style="display:inline-block;">Password:</label>
		<span onclick="showPw()" style="font-size:0.95em;float:right;margin-right:16%;margin-top:2px;opacity:0.9;user-select:none;cursor:pointer;">show</span>
		<br>
		<input autocomplete="current-password" id="current-password" type="password" class="formtext" autofocus required>
		<span onclick="clearForm()" style="margin-left:5px; user-select:none; cursor:pointer;">X</span><br>
		<input type="submit" name="Submit" id="submit" value="OK" style="width:120px; margin-top:12px;">
	</form>

	<div id="slideReveal" style="height:0px; transition:height 300ms; overflow:hidden; cursor:pointer; _padding-top:10px;">
	    <div style="clear:all;height:10px; _background:#666;"></div>
		<select id="avSelect" class="select" onchange="getStream(this)" style="_margin-top:10px"></select>
		<div style="margin-top:5px;"></div>

		<div style="columns:7rem auto;white-space:nowrap;max-width:340px; padding-bottom:10px;">
			<div id="muteMicDiv" _style="display:none;">
				<input type="checkbox" id="muteMic" class="checkbox" />
				<label class="menulabel2" id="muteMiclabel" for="muteMic">Mic muted</label>
			</div>
			<!--label class="menulabel2" id="" _style="display:none;">
				<input type="checkbox" id="" class="checkbox"> Ring mute</label-->
			<label class="menulabel2" id="isHiddenlabel" style="display:none;">
				<input type="checkbox" id="isHidden" class="checkbox"> Hide me</label>
			<label class="menulabel2" id="autoanswerlabel" style="display:none;">
				<input type="checkbox" id="autoanswer" class="checkbox"> Auto-Answer</label>
			<label class="menulabel2" id="fullscreenlabel">
				<input type="checkbox" id="fullscreen" class="checkbox"> Full screen</label>
		</div>
	</div>

	<div id="progressSend" style="width:100%;max-width:460px;padding-top:10px;display:none;">
		<div id="progressSendLabel">sending:</div>
		<progress id="fileProgressSend" max="0" value="0" style="width:100%" onclick="stopProgressSend()"></progress>
	</div>
	<div id="download" style="padding-top:10px; padding-bottom:10px; display:none;"></div>
	<div id="progressRcv" style="width:100%;max-width:460px;display:none;">
		<div id="progressRcvLabel">receiving:</div>
		<progress id="fileProgressRcv" max="0" value="0" style="width:100%" onclick="stopProgressRcv()"></progress>
	</div>

	<div id="msgboxdiv" style="padding-top:10px;padding-bottom:10px;display:none;">
		<textarea id="msgbox" class="msgbox" spellcheck="false""></textarea>
		<div id="textbox" style="display:none;">
			<form action="javascript:;" onsubmit="submitFormDone(2)">
				<input name="enterText" id="enterText" type="text" class="formtext" style="width:97%; max-width:550px;">
				<input type="submit" name="Submit" id="submitText" value="" style="display:none">
			</form>
		</div>
	</div>

	<div id="waitingCallersTitle" class="callListTitle" style="color:#f46; display:none;">Waiting callers:</div>
	<div id="waitingCallers" class="callList" style="display:none;"></div>

	<div id="ownlink" style="opacity:0.9; padding-top:10px; padding-bottom:10px; display:none;"></div>

	<div id="missedCallsTitle" class="callListTitle" style="display:none;">Missed calls:</div>
	<div id="missedCalls" class="callList" style="display:none;"></div>

	<div id="timer" class="timer">4:32</div>
	<div style="opacity:0.7;padding-top:8px;user-select:none;">WebCall by <a id="webcallhome" href="https://timur.mobi/webcall">timur.mobi</a> <span id="version"></span></div>
</div>
</div>
</body>

<script>
const apiPath = "/rtcsig";
var gentle = true;
</script>
<script src="client.js"></script>
<script src="callee.js"></script>
<script src="prefercodec.js"></script>
<script src="adapter-latest.js"></script>

